---
# tasks/main.yml

- name: Build and install forked gits
  community.general.make:
    target: install
    chdir: '{{ ansible_user_dir }}/Documents/{{ item.origin | basename }}'
  with_items: '{{ forked_gits }}'
  when: item.origin | basename != 'slock'

- name: Build and install slock
  block:
    - name: Build slock
      community.general.make:
        chdir: '{{ ansible_user_dir }}/Documents/slock'
    - name: Install slock
      community.general.make:
        target: install
        chdir: '{{ ansible_user_dir }}/Documents/slock'
      become: yes

- name: Build and install cloned gits
  block:
    - name: Make build system
      community.general.make:
        target: install
        chdir: '{{ ansible_user_dir }}/Documents/{{ item | basename }}'
        params:
          PREFIX: ~/.local
      with_items: '{{ cloned_gits_make }}'
      ignore_errors: yes
    - name: Meson build system
      ansible.builtin.shell: |
        cd '{{ ansible_user_dir }}/Documents/{{ item | basename }}'
        meson setup build --prefix '~/.local'
        meson compile -C build
        meson install -C build
        exit 0
      with_items: '{{ cloned_gits_meson }}'
    - name: Automake ctags
      ansible.builtin.shell: |
        cd '{{ ansible_user_dir }}/Documents/{{ ctags_git | basename }}'
        ./autogen.sh
        ./configure --prefix=~/.local
        make
        make install
        exit 0
    - name: Install distrobox
      ansible.builtin.shell: |
        cd '{{ ansible_user_dir }}/Documents/{{ distrobox_git | basename }}'
        ./install
        exit 0
